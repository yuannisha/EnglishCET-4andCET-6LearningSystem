{"version":3,"file":"mine.js","sources":["pages/mine/mine.vue","E:/HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWluZS9taW5lLnZ1ZQ"],"sourcesContent":["<script setup>\r\nimport { ref, onMounted, watch } from 'vue'\r\nimport { onShow } from '@dcloudio/uni-app'\r\n\r\n/**\r\n * @description 用户信息\r\n */\r\nconst userInfo = ref({\r\n    _id: '',\r\n    nickname: '',\r\n    avatar: '',\r\n    level: '',\r\n    study_days: 0,\r\n    points: 0   \r\n})\r\nconst isLogin = ref(false)\r\n\r\nconst avatarPreview = ref(false)    \r\n\r\n/**\r\n * @description 功能菜单列表\r\n */\r\nconst menuList = ref([\r\n  {\r\n    id: 1,\r\n    title: '学习记录',\r\n    icon: '/static/icons/record.png',\r\n    path: '/pages/mine/learning-records/learning-records'\r\n  },\r\n  {\r\n    id: 2,\r\n    title: '我的收藏',\r\n    icon: '/static/icons/favorite.png',\r\n    path: '/pages/mine/favorites/favorites'\r\n  },\r\n  {\r\n    id: 3,\r\n    title: '学习计划',\r\n    icon: '/static/icons/plan.png',\r\n    path: '/pages/mine/study-plan/study-plan'\r\n  },\r\n  {\r\n    id: 4,\r\n    title: '设置',\r\n    icon: '/static/icons/settings.png',\r\n    path: '/pages/mine/settings/settings'\r\n  }\r\n])\r\n\r\n/**\r\n * @description 跳转到对应页面\r\n * @param {string} path - 页面路径\r\n */\r\nconst navigateToPage = (path) => {\r\n  uni.navigateTo({\r\n    url: path\r\n  })\r\n}\r\n\r\n/** \r\n * @description 处理用户退出登录\r\n */\r\nconst handleLogout = () => {\r\n  uni.removeStorageSync('userInfo')\r\n  isLogin.value = false\r\n  userInfo.value = {\r\n    _id: '',\r\n    nickname: '',\r\n    avatar: '',\r\n    level: '',\r\n    study_days: 0,\r\n    points: 0\r\n  }\r\n  uni.navigateTo({\r\n    url: '/pages/login/login'\r\n  })    \r\n}\r\n\r\n/**\r\n * @description 处理头像点击\r\n */\r\nconst handleAvatarClick = () => {\r\n  if (!isLogin.value) {\r\n    uni.navigateTo({\r\n      url: '/pages/login/login'\r\n    })\r\n    return\r\n  }\r\n  \r\n  uni.showActionSheet({\r\n    itemList: ['查看头像', '更换头像'],\r\n    success: (res) => {\r\n      if (res.tapIndex === 0) {\r\n        avatarPreview.value = true\r\n        console.log(\"userInfo.value.avatar\",userInfo.value.avatar)  \r\n      } else {\r\n        // 更换头像\r\n        uni.chooseImage({\r\n          count: 1,\r\n          sizeType: ['compressed'],\r\n          sourceType: ['album', 'camera'],\r\n          success: async (res) => {\r\n            const tempFilePath = res.tempFilePaths[0]\r\n            \r\n            try {\r\n              uni.showLoading({ title: '上传中...' })\r\n              \r\n              // 上传图片到云存储\r\n              const uploadRes = await uniCloud.uploadFile({\r\n                filePath: tempFilePath,\r\n                cloudPath: `avatar/${Date.now()}-${Math.random().toString(36).substr(2)}.jpg`\r\n              })\r\n              \r\n              // 更新用户信息\r\n              const { result } = await uniCloud.callFunction({\r\n                name: 'updateUserInfo',\r\n                data: {\r\n                  userId: userInfo.value._id,\r\n                  avatar: uploadRes.fileID\r\n                }\r\n              })\r\n              \r\n              if (result.code === 0) {\r\n                userInfo.value.avatar = uploadRes.fileID\r\n                const storedUserInfo = uni.getStorageSync('userInfo')\r\n                storedUserInfo.avatar = uploadRes.fileID\r\n                uni.setStorageSync('userInfo', storedUserInfo)\r\n                \r\n                uni.showToast({\r\n                  title: '更新成功',\r\n                  icon: 'success'\r\n                })\r\n              }\r\n            } catch (e) {\r\n              uni.showToast({\r\n                title: '更新失败',\r\n                icon: 'none'\r\n              })\r\n            } finally {\r\n              uni.hideLoading()\r\n            }\r\n          }\r\n        })\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nonShow(() => {\r\n    console.log(\"storedUserInfo\",uni.getStorageSync('userInfo'))\r\n    console.log(\"userInfo\",userInfo.value)    \r\n  const storedUserInfo = uni.getStorageSync('userInfo')\r\n  if (!storedUserInfo) {\r\n    uni.showToast({\r\n      title: '请先登录',\r\n      icon: 'none',\r\n      duration: 2000  \r\n    })\t\r\n    uni.navigateTo({\r\n      url: '/pages/login/login'\r\n    })\r\n  } else {\r\n    isLogin.value = true\r\n    userInfo.value = storedUserInfo\r\n  }\t\r\n})\r\n</script>\r\n\r\n<template>\r\n  <view class=\"container\">\r\n    <!-- 用户信息卡片 -->\r\n    <view class=\"user-card\" @tap=\"handleAvatarClick\">\r\n      <image class=\"avatar\" :src=\"userInfo.avatar || '/static/avatar/default.png'\" mode=\"aspectFill\" />\r\n      <view class=\"user-info\">\r\n        <text class=\"nickname\">{{userInfo.nickname || '未登录' }}</text>\r\n        <text class=\"level\">{{ userInfo.level || '英语小白' }}</text>\r\n      </view>\r\n    </view>\r\n    \r\n    <!-- 学习数据 -->\r\n    <view class=\"study-data\" v-if=\"isLogin\">\r\n      <view class=\"data-item\">\r\n        <text class=\"data-num\">{{ userInfo.study_days || 0  }}</text>\r\n        <text class=\"data-label\">学习天数</text>\r\n      </view>\r\n      <view class=\"data-item\">\r\n        <text class=\"data-num\">{{ userInfo.points || 0 }}</text>\r\n        <text class=\"data-label\">积分</text>\r\n      </view>\r\n    </view>\r\n    \r\n    <!-- 功能菜单 -->\r\n    <view class=\"menu-list\">\r\n      <view \r\n        class=\"menu-item\" \r\n        v-for=\"item in menuList\" \r\n        :key=\"item.id\"\r\n        @tap=\"navigateToPage(item.path)\"\r\n        v-if=\"isLogin\"\r\n      >\r\n        <image class=\"menu-icon\" :src=\"item.icon\" mode=\"aspectFit\" />\r\n        <text class=\"menu-title\">{{ item.title }}</text>\r\n        <text class=\"menu-arrow\">></text>\r\n      </view>\r\n      \r\n      <view v-if=\"isLogin\" class=\"menu-item\" @tap=\"navigateToPage('/pages/mine/center')\">\r\n        <image class=\"menu-icon\" src=\"/static/icons/personal.png\" mode=\"aspectFit\" /> \r\n        <text class=\"menu-title\">个人中心</text>\r\n        <text class=\"menu-arrow\">></text>\r\n      </view>\r\n      \r\n      <view v-if=\"isLogin\" class=\"menu-item\" @tap=\"handleLogout\">\r\n        <image class=\"menu-icon\" src=\"/static/icons/logout.png\" mode=\"aspectFit\" /> \r\n        <text class=\"menu-title\">退出登录</text>\r\n        <text class=\"menu-arrow\">></text>\r\n      </view>\r\n    </view>\r\n    <!-- 查看头像，如果登陆了且有头像，加一层遮罩，点击遮罩关闭 -->\r\n    <view class=\"avatar-preview-mask\" v-if=\"isLogin && userInfo.avatar && avatarPreview \" @tap=\"avatarPreview = false\">\r\n        <view class=\"avatar-preview-mask-content\"> \r\n            <image :src=\"userInfo.avatar\" mode=\"aspectFill\" />\r\n        </view>\r\n    </view> \r\n  </view>\r\n</template>\r\n\r\n<style>\r\n.container {\r\n  padding: 30rpx;\r\n  background-color: #f5f5f5;\r\n  min-height: 100vh;\r\n}\r\n\r\n.user-card {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 40rpx;\r\n  background-color: #4095E5;\r\n  border-radius: 20rpx;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.avatar {\r\n  width: 120rpx;\r\n  height: 120rpx;\r\n  border-radius: 60rpx;\r\n  margin-right: 30rpx;\r\n  border: 4rpx solid rgba(255,255,255,0.3);\r\n}\r\n\r\n.user-info {\r\n  color: #fff;\r\n}\r\n\r\n.nickname {\r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n  display: block;\r\n  margin-bottom: 10rpx;\r\n}\r\n\r\n.level {\r\n  font-size: 24rpx;\r\n  opacity: 0.9;\r\n}\r\n\r\n.study-data {\r\n  display: flex;\r\n  justify-content: space-around;\r\n  background-color: #fff;\r\n  border-radius: 20rpx;\r\n  padding: 30rpx;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.data-item {\r\n  text-align: center;\r\n}\r\n\r\n.data-num {\r\n  font-size: 36rpx;\r\n  color: #333;\r\n  font-weight: bold;\r\n  display: block;\r\n  margin-bottom: 10rpx;\r\n}\r\n\r\n.data-label {\r\n  font-size: 24rpx;\r\n  color: #666;\r\n}\r\n\r\n.menu-list {\r\n  background-color: #fff;\r\n  border-radius: 20rpx;\r\n  padding: 0 20rpx;\r\n}\r\n\r\n.menu-item {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 30rpx 0;\r\n  border-bottom: 1px solid #eee;\r\n}\r\n\r\n.menu-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.menu-icon {\r\n  width: 40rpx;\r\n  height: 40rpx;\r\n  margin-right: 20rpx;\r\n}\r\n\r\n.menu-title {\r\n  flex: 1;\r\n  font-size: 28rpx;\r\n  color: #333;\r\n}\r\n\r\n.menu-arrow {\r\n  color: #999;\r\n  font-size: 32rpx;\r\n}\r\n\r\n.avatar-preview-mask {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n  z-index: 1000;\r\n}      \r\n\r\n.avatar-preview-mask-content {\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}   \r\n</style> ","import MiniProgramPage from 'D:/programs2024to2025/yulidanprogram/second/EnglishCET-4andCET-6LearningSystem/pages/mine/mine.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","res","uniCloud","onShow","MiniProgramPage"],"mappings":"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"}